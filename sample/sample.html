<!DOCTYPE HTML>
<html>
	<head>
		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="../dist/shogi-board.js" charset="utf-8"></script>
		<style>
		</style>
	</head>
	<body>
		<table id=theboard >
		</table>
		<table id=theboard2>
		</table>

		<script>
			var bd =
			[[["NK",1],["NY",1],["NG",1],["KI",1],["OU",1],["KI",1],["GI",1],["KE",1],["KY",1]]
			,[  null  ,["RY",1],  null  ,  null  ,  null  ,  null  ,  null  ,["UM",1],  null  ]
			,[["FU",1],["FU",1],["FU",1],["TO",1],["TO",1],["TO",1],["FU",1],["FU",1],["FU",1]]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0]]
			,[  null  ,["KA",0],  null  ,  null  ,  null  ,  null  ,  null  ,["HI",0],  null  ]
			,[["NK",0],["NY",0],["NG",0],["KI",0],["OU",0],["KI",0],["GI",0],["KE",0],["KY",0]]
			];
		</script>

		<script>(function() {
			var sel = d3.select("#theboard");
			sel.node().style.padding="11px 11px 10px"; // does not work
			sel.node().style.borderCollapse="collapse";
			sel.node().style.backgroundImage = "url(" + "../../" + ShogiBoard.preset.grid.dot_xy + ")";
			sel
				.selectAll("tr").data(bd)
				.enter().append("tr")
				.selectAll("td").data(d3.entries)
				.enter().append("td")
				.attr("style", "margin: 0; padding: 0")
				.each(function(d) {
					var value = d['value'];
					var src;
					if(value) {
						src = "../../" + ShogiBoard.preset.piece.ryoko_torafu[value[0]][value[1]];
					} else {
						src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAwCAYAAACITIOYAAAAH0lEQVRo3u3BMQEAAADCoPVPbQZ/oAAAAAAAAAAAPgMgcAAB3kcvEQAAAABJRU5ErkJggg==";
					}
					var img = this.firstChild;
					if (img) {
						img.src = src;
					} else {
						img = document.createElement("img");
						img.src = src;
						this.appendChild(img);
					}
				})
			;
		})();</script>
		<script>(function() {
			var textmap =
			{"FU":"歩"
			,"GI":"銀"
			,"HI":"飛"
			,"KA":"角"
			,"KE":"桂"
			,"KI":"金"
			,"KY":"香"
			,"NG":"成銀"
			,"NK":"成香"
			,"NY":"成桂"
			,"OU":"玉"
			,"RY":"龍"
			,"TO":"と"
			,"UM":"馬"
			};
			var colormap =
			{"FU":"black"
			,"GI":"black"
			,"HI":"black"
			,"KA":"black"
			,"KE":"black"
			,"KI":"black"
			,"KY":"black"
			,"NG":"red"
			,"NK":"red"
			,"NY":"red"
			,"OU":"玉"
			,"RY":"red"
			,"TO":"red"
			,"UM":"red"
			};
			var dhandler = function(d) {
				var value = d['value'];
				var div = document.createElement('div');
				var style = "font-size: 1.5em;";
				var transform = [];
				if (value && value[1] == 1) {
					transform.push("rotate(180deg)");
				}
				if (value) {
					var chs = textmap[value[0]].split('');
					var firstchar = true;
					for (var i = 0; i < chs.length; ++i) {
						if (firstchar) {
							firstchar = false;
						} else {
							div.appendChild(document.createElement('br'));
						}
						var c = chs[i];
						var span = document.createElement('span');
						var span_style = "display: inline-block;width:1em;";
						if (chs.length > 1) {
							span_style += "transform:scaleY(0.5);";
						}
						span.style = span_style;
						span.appendChild(document.createTextNode(c));
						div.appendChild(span);
					}
					if (chs.length > 1) {
						// transform.push("scaleY(0.5)");
						style += "line-height: 0.5;";
					}

					var color = colormap[value[0]];
					style += "color:" + color + ";";
				} else {
					div.appendChild(document.createTextNode(' '));
				}
				if (transform.length > 0) {
					style += "transform: " + transform.join(' ') + ';'
				}
				div.style = style;
				this.appendChild(div);
			};
			var sel = d3.select("#theboard2");
			sel.node().style.borderCollapse="collapse";
			sel
				.selectAll("tr").data(bd)
				.enter().append("tr")
				.selectAll("td").data(d3.entries)
				.enter().append("td")
				.attr("style", "margin: 0; padding: 0; border: solid black 1px; width: 2em; height: 2.5em; text-align: center; overflow: hidden;")
				.each(dhandler)
				;
		})();</script>
	</body>
</html>
