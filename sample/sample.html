<!DOCTYPE HTML>
<html>
	<head>
		<meta charset=utf-8>
		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="../dist/shogi-board.js" charset="utf-8"></script>
		<style>
		</style>
	</head>
	<body>
		<table id=theboard >
		</table>
		<table id=theboard2>
		</table>
		<div id=theboard3>
		</div>

		<script>
			var bd =
			[[["NK",1],["NY",1],["NG",1],["KI",1],["OU",1],["KI",1],["GI",1],["KE",1],["KY",1]]
			,[  null  ,["RY",1],  null  ,  null  ,  null  ,  null  ,  null  ,["UM",1],  null  ]
			,[["FU",1],["FU",1],["FU",1],["TO",1],["TO",1],["TO",1],["FU",1],["FU",1],["FU",1]]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ,  null  ]
			,[["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0],["FU",0]]
			,[  null  ,["KA",0],  null  ,  null  ,  null  ,  null  ,  null  ,["HI",0],  null  ]
			,[["NK",0],["NY",0],["NG",0],["KI",0],["OU",0],["KI",0],["GI",0],["KE",0],["KY",0]]
			];
		</script>

		<script>(function() {
			var sel = d3.select("#theboard");
			sel.node().style.padding="11px 11px 10px"; // does not work
			sel.node().style.borderCollapse="collapse";
			sel.node().style.backgroundImage = "url(" + "../../" + ShogiBoard.preset.grid.dot_xy + ")";
			sel
				.selectAll("tr").data(bd)
				.enter().append("tr")
				.selectAll("td").data(d3.entries)
				.enter().append("td")
				.attr("style", "margin: 0; padding: 0")
				.each(function(d) {
					var value = d['value'];
					var src;
					if(value) {
						src = "../../" + ShogiBoard.preset.piece.ryoko_torafu[value[0]][value[1]];
					} else {
						src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAwCAYAAACITIOYAAAAH0lEQVRo3u3BMQEAAADCoPVPbQZ/oAAAAAAAAAAAPgMgcAAB3kcvEQAAAABJRU5ErkJggg==";
					}
					var img = this.firstChild;
					if (img) {
						img.src = src;
					} else {
						img = document.createElement("img");
						img.src = src;
						this.appendChild(img);
					}
				})
			;
		})();</script>
		<script>
			var textmap =
			{"FU":"歩"
			,"GI":"銀"
			,"HI":"飛"
			,"KA":"角"
			,"KE":"桂"
			,"KI":"金"
			,"KY":"香"
			,"NG":"成銀"
			,"NK":"成香"
			,"NY":"成桂"
			,"OU":"玉"
			,"RY":"龍"
			,"TO":"と"
			,"UM":"馬"
			};
			var colormap =
			{"FU":"black"
			,"GI":"black"
			,"HI":"black"
			,"KA":"black"
			,"KE":"black"
			,"KI":"black"
			,"KY":"black"
			,"NG":"red"
			,"NK":"red"
			,"NY":"red"
			,"OU":"black"
			,"RY":"red"
			,"TO":"red"
			,"UM":"red"
			};
		</script>
		<script>(function() {
			var dhandler = function(d) {
				var value = d['value'];
				var div = document.createElement('div');
				var style = "font-size: 1.8em;";
				var transform = [];
				if (value && value[1] == 1) {
					transform.push("rotate(180deg)");
				}
				if (value) {
					var chs = textmap[value[0]].split('');
					var firstchar = true;
					for (var i = 0; i < chs.length; ++i) {
						if (firstchar) {
							firstchar = false;
						} else {
							div.appendChild(document.createElement('br'));
						}
						var c = chs[i];
						var span = document.createElement('span');
						var span_style = "display: inline-block;width:1em;";
						if (chs.length > 1) {
							span_style += "transform:scaleY(0.5);";
						}
						span.style = span_style;
						span.appendChild(document.createTextNode(c));
						div.appendChild(span);
					}
					if (chs.length > 1) {
						// transform.push("scaleY(0.5)");
						style += "line-height: 0.5;";
					}

					var color = colormap[value[0]];
					style += "color:" + color + ";";
				} else {
					div.appendChild(document.createTextNode(' '));
				}
				if (transform.length > 0) {
					style += "transform: " + transform.join(' ') + ';'
				}
				div.style = style;
				this.appendChild(div);
			};
			var sel = d3.select("#theboard2");
			sel.node().style.borderCollapse="collapse";
			sel
				.selectAll("tr").data(bd)
				.enter().append("tr")
				.selectAll("td").data(d3.entries)
				.enter().append("td")
				.attr("style", "margin: 0; padding: 0; border: solid black 1px; width: 2em; height: 2.5em; text-align: center; overflow: hidden;")
				.each(dhandler)
				;
		})();</script>
		<script>
			var pcs0 =
			[ ["FU","9","7"] , ["FU","8","7"] , ["FU","7","7"]
			, ["FU","6","7"] , ["FU","5","7"] , ["FU","4","7"]
			, ["FU","3","7"] , ["FU","2","7"] , ["FU","1","7"]
			, ["KA","8","8"] , ["HI","2","8"]
			, ["KY","9","9"] , ["KY","1","9"]
			, ["KE","8","9"] , ["KE","2","9"]
			, ["GI","7","9"] , ["GI","3","9"]
			, ["KI","6","9"] , ["KI","4","9"]
			, ["OU","5","9"]
			];
			var pcs1 =
			[ ["FU","1","3"] , ["FU","2","3"] , ["FU","3","3"]
			, ["FU","4","3"] , ["FU","5","3"] , ["FU","6","3"]
			, ["FU","7","3"] , ["FU","8","3"] , ["FU","9","3"]
			, ["KA","2","2"] , ["HI","8","2"]
			, ["KY","1","1"] , ["KY","9","1"]
			, ["KE","2","1"] , ["KE","8","1"]
			, ["GI","3","1"] , ["GI","7","1"]
			, ["KI","4","1"] , ["KI","6","1"]
			, ["OU","5","1"]
			];
		</script>
		<script>(function() {
			var svgWidth = 330;
			var svgHeight = 360;
			var boardWidth = 300;
			var boardHeight = 330;
			var sel = d3.select("#theboard3");
			var svg = sel.append("svg")
			  .attr("width", svgWidth)
			  .attr("height", svgHeight)
			  ;
			var scaleX = d3.scale.linear().domain([9, 0]).range([15, boardWidth + 15]);
			var scaleY = d3.scale.linear().domain([0, 9]).range([20, boardHeight + 20]);
			svg.selectAll("line.gridX")
			  .data(d3.range(0, 9+1, 1))
			  .enter().append("line")
			  .attr("class", "gridX")
			  .attr("x1", function(d) { return scaleX(d) })
			  .attr("y1", scaleY(0))
			  .attr("x2", function(d) { return scaleX(d) })
			  .attr("y2", scaleY(9))
			  .attr("stroke", "black")
			  ;
			svg.selectAll("line.gridY")
			  .data(d3.range(0, 9+1, 1))
			  .enter().append("line")
			  .attr("class", "gridY")
			  .attr("x1", scaleX(0))
			  .attr("y1", function(d) { return scaleY(d) })
			  .attr("x2", scaleX(9))
			  .attr("y2", function(d) { return scaleY(d) })
			  .attr("stroke", "black")
			  ;
			svg.selectAll("circle.star")
			  .data([[3, 3], [3, 6], [6, 3], [6, 6]])
			  .enter().append("circle")
			  .attr("class", "star")
			  .attr("cx", function(d) { return scaleX(d[0]) })
			  .attr("cy", function(d) { return scaleY(d[1]) })
			  .attr("r", "3")
			  .attr("stroke", "black")
			  .attr("fill", "black")
			  ;
			svg.selectAll("text.gaugeX")
			  .data(['１','２','３','４','５','６','７','８','９'])
			  .enter().append("text")
			  .attr("font-size",10)
			  .attr("text-anchor","middle")
			  .attr("dominant-baseline","middle")
			  .attr("x",function(d, i) { return scaleX(i + 0.5); })
			  .attr("y",scaleY(-0.2))
			  .text(function(d) { return d })
			  ;
			svg.selectAll("text.gaugeY")
			  .data(['一','二','三','四','五','六','七','八','九'])
			  .enter().append("text")
			  .attr("font-size",10)
			  .attr("text-anchor","middle")
			  .attr("dominant-baseline","middle")
			  .attr("x",scaleX(-0.2))
			  .attr("y",function(d, i) { return scaleY(i + 0.5); })
			  .text(function(d) { return d })
			  ;
		})()</script>
	</body>
</html>
